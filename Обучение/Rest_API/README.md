# REST API для отправки данных о перевалах

Этот REST API позволяет отправлять данные о перевалах на сервер. API принимает JSON данные о перевале и возвращает результат операции в виде JSON объекта.

## Задача

Задача заключалась в создании базы данных, написании класса для работы с базой данных и реализации метода POST /submitData для отправки данных о перевале.

## Информация о файлах
* `convert_img.py`: код для конвертации изображения в строку
* `DatabaseHandler.py`: код для работы с базой данных
* `test.json`: тестовые данные
* `tests`: Директория для с тестами API и класса DatabaseHandler
* `submitData.py`: методы API 
* `test_1.png`: пример вывода теста API
* `read.me`: примеры вызова REST API с хостинга Yandex Cloud

## Методы API

### POST /submitData

Этот метод принимает JSON данные о перевале и отправляет их на сервер. Данные о перевале должны содержать следующие поля:

* `beauty_title`: название перевала
* `title`: название перевала
* `other_titles`: другие названия перевала
* `connect`: что соединяет перевал
* `add_time`: время добавления перевала
* `user`: информация о пользователе, который отправил данные о перевале
	+ `email`: адрес электронной почты пользователя
	+ `fam`: фамилия пользователя
	+ `name`: имя пользователя
	+ `otc`: отчество пользователя
	+ `phone`: телефон пользователя
* `coords`: координаты перевала
	+ `latitude`: широта перевала
	+ `longitude`: долгота перевала
	+ `height`: высота перевала
* `level`: уровень сложности перевала
	+ `winter`: уровень сложности зимой
	+ `summer`: уровень сложности летом
	+ `autumn`: уровень сложности осенью
	+ `spring`: уровень сложности весной
* `images`: изображения перевала
	+ `data`: данные изображения
	+ `title`: название изображения

Результат метода:

* `status`: код HTTP
	+ 500: ошибка при выполнении операции
	+ 400: Bad Request (при нехватке полей)
	+ 200: успех
* `message`: строка с причиной ошибки или сообщением об успехе
* `id`: идентификатор добавленной записи

### GET /submitData/<id>

Этот метод возвращает информацию о перевале по его идентификатору.

### PATCH /submitData/<id>

Этот метод обновляет информацию о перевале по его идентификатору.

### GET /submitData/?user__email=<email>

Этот метод возвращает список данных о перевалах, которые были отправлены пользователем с указанным адресом электронной почты.

## Документация

Документация к API написана с помощью Swagger.
Рекомендую также посмотреть установленные библиотеки в `requirements.txt`

## Тесты

Тесты класса DatabaseHandler:
![Результаты тестирования](test_1.png)
Тесты API:
![Результаты тестирования](test_1.png)


### Результаты тестирования

#### Тесты класса DatabaseHandler

| Тест | Результат |
| --- | --- |
| test_add_user | PASSED |
| test_add_coord | PASSED |
| test_add_pereval | PASSED |

**Время выполнения:** 0.66s

#### Тесты API

| Тест | Результат |
| --- | --- |
| test_submit_data | PASSED |
| test_get_submit_data | PASSED |
| test_patch_submit_data | PASSED |

#### Пример вывода:
![Результаты тестирования](test_1.png)

**Время выполнения:** 6.86s

### Общий результат

* Всего тестов: 6
* Успешных тестов: 6
* Время выполнения всех тестов: 7.52s

Примечание: Тесты были запущены с помощью pytest в среде Pycharm.

Примеры вызова REST API с хостинга лежат в файле `read.me`
REST API тестировался можно использовать CURL. Выполнить эту команду:

#### Запросы curl
В коде есть проверка на уникальный ключ, она не будет работать, если вы будете использовать его ещё раз.

Поэтому если вы хотите попробовать написать запрос curl, нужно изменить переменные в запросе 

```bash
     curl -X POST -H "Content-Type: application/json" -d "{\"beauty_title\": \"Перевал\", \"title\": \"Тестовый Перевал\", \"other_titles\": \"\", \"connect\": \"\", \"add_time\": \"2021-09-22 13:18:13\", \"user\": {\"email\": \"unique_email@example.com\", \"fam\": \"Новиков\", \"name\": \"Алексей\", \"otc\": \"Алексеевич\", \"phone\": \"+7 987 654 32 10\"}, \"coords\": {\"latitude\": 50.0, \"longitude\": 40.0, \"height\": 1500}, \"level\": {\"winter\": \"\", \"summer\": \"1Б\", \"autumn\": \"1Б\", \"spring\": \"\"}, \"images\": [{\"data\": \"<base64_encoded_image_data>\", \"title\": \"Тестовое изображение\"}]}" http://127.0.0.1:5000/submitData     
```

Также для добавления изображения в запрос (в формате Base64). 
Необходимо добавить свой путь к изображению в файле 
`convert_img.py`. Вывод конвертации txt нужно скопировать и заменить строку `<base64_encoded_image_data>`.

Если возникают ошибки можно протестировать и проверить работоспособность запросов без изображения.