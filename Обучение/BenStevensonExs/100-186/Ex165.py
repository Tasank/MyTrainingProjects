"""
Упражнение 165. Самые популярные имена за период.
Напишите программу, которая будет определять самые популярные имена для детей в выбранном пользователем периоде.
Используйте базу данных из упражнения 163.
Позвольте пользователю выбрать первый и последний год анализируемого диапазона.
В результате программа должна вывести на экран мужское и женское имена,
которые были чаще остальных даны детям в заданный период времени.
"""
import os

# самые популярные имена
boys_counter = {}
girls_counter = {}

# Путь к папке с файлами, расположенный рядом с текущим скриптом
data_path = os.path.join(os.path.dirname(__file__), 'names')

# Ввод диапазона годов пользователем
first_year = int(input('Введите первый год: '))
second_year = int(input('Введите последний год: '))

# Обработка файлов
for year in range(first_year, second_year + 1):
    file_name = f'yob{year}.txt'
    file_path = os.path.join(data_path, file_name)

    # Проверка существования файла
    if os.path.exists(file_path):
        try:
            with open(file_path, 'r') as read_file:
                for line in read_file:
                    # _ в файле это не нужная нам переменная штата
                    name, gender, _ = line.strip().split(',')

                    # Подсчет имен
                    if gender == 'M':
                        if name in boys_counter:
                            boys_counter[name] += 1
                        else:
                            boys_counter[name] = 1
                    elif gender == 'F':
                        if name in girls_counter:
                            girls_counter[name] += 1
                        else:
                            girls_counter[name] = 1

        except Exception as e:
            print(f'Не удалось открыть файл {file_name}: {e}')
    else:
        print(f'Файл {file_name} не найден.')

# Определение самых популярных имен
boys_name_leader = max(boys_counter, key=boys_counter.get) if boys_counter else 'Нет данных'
girls_name_leader = max(girls_counter, key=girls_counter.get) if girls_counter else 'Нет данных'

# Вывод результатов
print('Результат: ')
print("Самое популярное имя мальчиков:", boys_name_leader)
print("Самое популярное имя девочек:", girls_name_leader)

"""
(Объяснение)
Чем этот код отличается от кода в упр. 163? Если кратко то:
1. Диапазон годов:
   - Первый код: Пользователь задает диапазон годов для анализа.
   - Второй код: Анализируется фиксированный диапазон с 1880 по 2023 год.

2. Агрегация данных:
   - Первый код: Суммирует количество упоминаний каждого имени за весь заданный период.
   - Второй код: Определяет самые популярные имена для каждого года и сохраняет их в множества.

3. Использование данных из файлов:
   - Первый код: Учитывает количество упоминаний имен за весь период, суммируя значения.
   - Второй код: Для каждого года находит самое популярное имя и добавляет его в множество уникальных популярных имен.

4. Итоговый результат:
   - Первый код: Выводит одно самое популярное имя для мальчиков и одно для девочек за весь указанный период.
   - Второй код: Выводит списки всех уникальных самых популярных имен для мальчиков и девочек за каждый год из указанного диапазона.
"""